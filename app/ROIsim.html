<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>대출·투자 경영 시뮬</title>
  <meta name="color-scheme" content="light dark" />
  <style>
    :root{
      --bg: #0b0f14;
      --panel: #121826;
      --muted: #94a3b8;
      --text: #e5e7eb;
      --accent: #60a5fa;
      --ok: #34d399;
      --warn: #f59e0b;
      --bad: #ef4444;
      --border: #1f2937;
      --pill: #0ea5e9;
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg: #f7fafc;
        --panel: #ffffff;
        --muted: #64748b;
        --text: #0f172a;
        --accent: #2563eb;
        --ok: #059669;
        --warn: #b45309;
        --bad: #b91c1c;
        --border: #e2e8f0;
        --pill: #0284c7;
      }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:linear-gradient(180deg,var(--bg),#0f172a 70%);
      color:var(--text); font: 16px/1.5 ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", "Apple SD Gothic Neo", "Helvetica Neue", Arial;
    }
    .wrap{max-width:1100px;margin:0 auto;padding:24px}
    header{display:flex;align-items:center;gap:14px;margin-bottom:18px}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{width:36px;height:36px;border-radius:12px;background:radial-gradient(120% 120% at 20% 20%, var(--accent), #8b5cf6 60%, #f43f5e); box-shadow: 0 6px 20px rgba(99,102,241,.35)}
    h1{font-size:20px;margin:0;font-weight:800;letter-spacing:.2px}
    .cash-pill{margin-left:auto;padding:8px 12px;border-radius:999px;background:rgba(14,165,233,.12);border:1px solid rgba(14,165,233,.35);color:#bae6fd;font-weight:700}

    .grid{display:grid;gap:14px}
    .stats{grid-template-columns: repeat(4, 1fr)}
    .controls{grid-template-columns: 1.2fr 1.8fr .9fr}
    @media (max-width: 980px){
      .stats{grid-template-columns: 1fr 1fr}
      .controls{grid-template-columns: 1fr}
    }

    .card{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow: 0 8px 24px rgba(0,0,0,.25)}
    .k{font-size:12px;color:var(--muted);letter-spacing:.3px;text-transform:uppercase}
    .v{font-size:28px;font-weight:800;margin-top:6px}
    .sub{font-size:12px;color:var(--muted)}

    .row{display:flex;gap:10px;align-items:center}
    input[type="number"], input[type="text"]{
      width:100%; padding:12px 14px; background:#0b1220; color:var(--text); border:1px solid var(--border); border-radius:12px; outline:none;
      transition:border .2s, box-shadow .2s; font-weight:600
    }
    @media (prefers-color-scheme: light){
      input[type="number"], input[type="text"]{background:#f8fafc;color:#0f172a}
    }
    input::placeholder{color:#64748b}
    input:focus{border-color:#60a5fa; box-shadow:0 0 0 6px rgba(96,165,250,.12)}
    button{cursor:pointer; border:1px solid var(--border); background:linear-gradient(180deg,#1f2937,#0b1220); color:#e5e7eb; padding:12px 16px; border-radius:12px; font-weight:800; letter-spacing:.2px; transition:transform .06s ease, box-shadow .2s}
    button:hover{box-shadow:0 12px 28px rgba(2,6,23,.45)}
    button:active{transform:translateY(1px)}
    button[disabled]{opacity:.5;cursor:not-allowed;filter:grayscale(.2)}
    input[disabled]{opacity:.6;cursor:not-allowed}
    button.primary{background:linear-gradient(180deg, #2dd4bf, #14b8a6); color:#052e2b}
    button.accent{background:linear-gradient(180deg,#60a5fa,#3b82f6); color:#051d3b}

    .biz-list{margin-top:16px}
    .biz-grid{display:grid; grid-template-columns: repeat(3, 1fr); gap:12px}
    @media (max-width: 1100px){ .biz-grid{grid-template-columns: repeat(2, 1fr)} }
    @media (max-width: 720px){ .biz-grid{grid-template-columns: 1fr} }

    .biz{position:relative; overflow:hidden}
    .badge{position:absolute; top:10px; right:10px; font-size:11px; font-weight:800; padding:6px 8px; border-radius:999px; border:1px solid rgba(255,255,255,.15); backdrop-filter: blur(8px)}
    .badge.neutral{background:rgba(148,163,184,.15); color:#cbd5e1}
    .badge.vboom{background:rgba(34,197,94,.18); color:#bbf7d0}
    .badge.boom{background:rgba(74,222,128,.16); color:#dcfce7}
    .badge.even{background:rgba(59,130,246,.16); color:#dbeafe}
    .badge.slump{background:rgba(245,158,11,.16); color:#fde68a}
    .badge.crash{background:rgba(239,68,68,.18); color:#fecaca}

    .biz .name{font-weight:800;font-size:16px;margin-bottom:6px}
    .kv{display:flex; justify-content:space-between; font-size:13px; color:var(--muted)}
    .kv strong{color:var(--text)}

    .legend{display:flex; gap:8px; flex-wrap:wrap; font-size:12px; color:var(--muted); margin-top:6px}
    .dot{display:inline-block; width:10px; height:10px; border-radius:50%; margin-right:6px; vertical-align:-1px}
    .dot.vboom{background:#22c55e}
    .dot.boom{background:#4ade80}
    .dot.even{background:#60a5fa}
    .dot.slump{background:#f59e0b}
    .dot.crash{background:#ef4444}

    .hint{font-size:12px;color:var(--muted)}
    .mini{font-size:11px;color:var(--muted)}
    .danger{color:var(--bad)}
    .success{color:var(--ok)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <h1>대출·투자 경영 시뮬</h1>
      </div>
      <div id="cashPill" class="cash-pill" title="보유 현금">현금 0 G</div>
    </header>

    <div id="bkBanner" class="card" style="display:none; border-color: var(--bad); background: rgba(239,68,68,.08); color:#fecaca; font-weight:700">파산 상태야… 리셋만 가능해</div>

    <!-- Stats -->
    <section class="grid stats">
      <div class="card">
        <div class="k">현재 대출총액</div>
        <div id="loanTotal" class="v">0 G</div>
      </div>
      <div class="card">
        <div class="k">저번턴 총지출</div>
        <div id="lastSpend" class="v">0 G</div>
        <div id="lastSpendSub" class="sub">(사업투자비용 0 + 대출이자 0 + 유지비용 0)</div>
      </div>
      <div class="card">
        <div class="k">이번턴 지출예정</div>
        <div id="forecastSpend" class="v">0 G</div>
        <div id="forecastSpendSub" class="sub">(대출이자 0 + 유지비용 0)</div>
      </div>
      <div class="card">
        <div class="k">저번턴 매출액</div>
        <div id="lastRevenue" class="v">0 G</div>
      </div>
    </section>

    <!-- Controls -->
    <section class="grid controls" style="margin-top:16px">
      <div class="card">
        <div class="k">대출</div>
        <div class="row" style="margin-top:8px">
          <input id="loanAmount" type="number" min="0" step="1" inputmode="numeric" placeholder="대출받을 금액" />
          <button id="loanBtn" class="accent" aria-label="대출받기">대출받기</button>
        </div>
        <div class="mini" style="margin-top:8px">대출은 원금 상환 없이 유지되고, 매 턴 <strong>10%</strong> 이자가 지출됨</div>
        <div class="row" style="margin-top:10px">
          <input id="repayAmount" type="number" min="0" step="1" inputmode="numeric" placeholder="상환할 금액" />
          <button id="repayBtn" class="primary" aria-label="대출 상환">대출 상환</button>
        </div>
        <div id="repayHint" class="hint" style="margin-top:6px"></div>
      </div>

      <div class="card">
        <div class="k">사업 투자</div>
        <div class="row" style="margin-top:8px">
          <input id="bizName" type="text" placeholder="사업 이름" />
          <input id="bizInvest" type="number" min="1" step="1" inputmode="numeric" placeholder="투자 금액" />
          <button id="investBtn" class="primary" aria-label="투자하기">투자</button>
        </div>
        <div class="mini" style="margin-top:8px">투자금의 <strong>10%</strong>가 매턴 유지비용으로 지출됨. 신규 사업은 <strong>첫 턴 매출 0</strong></div>
        <div id="investHint" class="hint" style="margin-top:6px"></div>
      </div>

      <div class="card" style="display:flex;flex-direction:column;justify-content:space-between">
        <div>
          <div class="k">턴</div>
          <div id="turnNum" class="v">1</div>
        </div>
        <button id="nextBtn" class="accent" style="width:100%;margin-top:10px;font-size:18px">턴 넘기기</button>
        <button id="resetBtn" style="width:100%;margin-top:8px">리셋</button>
      </div>
    </section>

    <!-- Business List -->
    <section class="biz-list">
      <div class="row" style="justify-content:space-between;margin-bottom:8px">
        <div class="k">투자한 사업들</div>
        <div class="legend">
          <span><i class="dot vboom"></i>대호황</span>
          <span><i class="dot boom"></i>호황</span>
          <span><i class="dot even"></i>본전</span>
          <span><i class="dot slump"></i>불황</span>
          <span><i class="dot crash"></i>대불황</span>
        </div>
      </div>
      <div id="bizGrid" class="biz-grid"></div>
    </section>
  </div>

  <script>
    // ---------- Utilities ----------
    const fmt = n => new Intl.NumberFormat('ko-KR').format(Math.floor(n)) + ' G';
    const clampInt = n => Math.max(0, Math.floor(Number(n || 0)));

    // ---------- State ----------
    const defaultState = {
      turn: 1,
      cash: 100,
      loanTotal: 0,
      bankrupt: false,
      businesses: [], // {id, name, invest, upkeep, age, lastRevenue, lastOutcome}
      currentTurnInvest: 0,
      last: { spend:0, invest:0, interest:0, upkeep:0, revenue:0 }
    };

    let S = load() || structuredClone(defaultState);

    // ---------- Elements ----------
    const el = sel => document.querySelector(sel);
    const loanTotalEl = el('#loanTotal');
    const lastSpendEl = el('#lastSpend');
    const lastSpendSubEl = el('#lastSpendSub');
    const forecastSpendEl = el('#forecastSpend');
    const forecastSpendSubEl = el('#forecastSpendSub');
    const lastRevenueEl = el('#lastRevenue');
    const cashPillEl = el('#cashPill');
    const turnNumEl = el('#turnNum');
    const bizGridEl = el('#bizGrid');

    const loanAmountEl = el('#loanAmount');
    const loanBtn = el('#loanBtn');
    const repayAmountEl = el('#repayAmount');
    const repayBtn = el('#repayBtn');
    const repayHintEl = el('#repayHint');

    const bizNameEl = el('#bizName');
    const bizInvestEl = el('#bizInvest');
    const investBtn = el('#investBtn');
    const investHintEl = el('#investHint');

    const nextBtn = el('#nextBtn');
    const resetBtn = el('#resetBtn');

    // ---------- Rendering ----------
    function render(){
      // Stats
      loanTotalEl.textContent = fmt(S.loanTotal);
      lastSpendEl.textContent = fmt(S.last.spend);
      lastSpendSubEl.textContent = `(사업투자비용 ${fmt(S.last.invest)} + 대출이자 ${fmt(S.last.interest)} + 유지비용 ${fmt(S.last.upkeep)})`;
      const fInterest = Math.floor(S.loanTotal * 0.10);
      const fUpkeep = S.businesses.reduce((a,b)=> a + Math.floor(b.invest * 0.10), 0);
      forecastSpendEl.textContent = fmt(fInterest + fUpkeep);
      forecastSpendSubEl.textContent = `(대출이자 ${fmt(fInterest)} + 유지비용 ${fmt(fUpkeep)})`;
      lastRevenueEl.textContent = fmt(S.last.revenue);
      cashPillEl.textContent = `현금 ${fmt(S.cash).replace(' G','')} G`;
      turnNumEl.textContent = S.turn;

      // Biz cards
      bizGridEl.innerHTML = '';
      if(S.businesses.length === 0){
        const empty = document.createElement('div');
        empty.className = 'card';
        empty.innerHTML = '<div class="hint">아직 투자한 사업이 없네… 대출로 종잣돈을 만들고, 사업에 투자해봐</div>';
        bizGridEl.appendChild(empty);
      } else {
        S.businesses.forEach(b => {
          const card = document.createElement('div');
          card.className = 'card biz';
          const badgeClass = outcomeClass(b.lastOutcome);
          const badgeText = b.age === 0 ? '신규' : (b.lastOutcome || '—');
          card.innerHTML = `
            <div class="badge ${b.age===0 ? 'neutral' : badgeClass}">${badgeText}</div>
            <div class="name">${escapeHtml(b.name)}</div>
            <div class="kv"><span>유지비용</span><strong>${fmt(Math.floor(b.invest*0.10))}</strong></div>
            <div class="kv"><span>저번턴 매출</span><strong>${fmt(b.lastRevenue || 0)}</strong></div>
            $1
            <div class="row" style="margin-top:10px;justify-content:flex-end"><button class="sellBtn" data-id="${b.id}" ${S.bankrupt ? 'disabled' : ''}>매각 (10%)</button></div>
          `;
          bizGridEl.appendChild(card);
        });
      }

      // Bankrupt UI lock
      S.bankrupt = S.cash <= 0 ? true : S.bankrupt;
      const banner = el('#bkBanner');
      if(banner) banner.style.display = S.bankrupt ? 'block' : 'none';
      setDisabled(S.bankrupt);

      save();
    }

    function outcomeClass(o){
      switch(o){
        case '대호황': return 'vboom';
        case '호황': return 'boom';
        case '본전': return 'even';
        case '불황': return 'slump';
        case '대불황': return 'crash';
        default: return 'neutral';
      }
    }
    function setDisabled(disabled){
      [loanAmountEl, loanBtn, repayAmountEl, repayBtn, bizNameEl, bizInvestEl, investBtn, nextBtn].forEach(n=>{ if(n) n.disabled = !!disabled; });
      document.querySelectorAll('.sellBtn').forEach(b=> b.disabled = !!disabled);
      if(resetBtn) resetBtn.disabled = false;
    }
    function checkBankrupt(){ if(S.cash <= 0){ S.bankrupt = true; } }

    function escapeHtml(str){
      return String(str).replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[s]));
    }

    // ---------- Actions ----------
    loanBtn.addEventListener('click', ()=>{
      const amt = clampInt(loanAmountEl.value);
      if(amt <= 0) return;
      S.loanTotal += amt;
      S.cash += amt;
      loanAmountEl.value = '';
      flashHint(investHintEl, `대출로 ${fmt(amt)} 확보됐어`, 'success');
      render();
    });
    loanAmountEl.addEventListener('keydown', e=>{ if(e.key==='Enter') loanBtn.click(); });

    repayBtn.addEventListener('click', ()=>{
      let amt = clampInt(repayAmountEl.value);
      if(amt <= 0) return;
      if(S.loanTotal <= 0){
        flashHint(repayHintEl, '상환할 대출이 없어', 'danger');
        return;
      }
      if(amt > S.cash){
        flashHint(repayHintEl, '현금이 부족해…', 'danger');
        return;
      }
      if(amt > S.loanTotal){
        amt = S.loanTotal;
        flashHint(repayHintEl, `대출잔액보다 큰 금액을 입력했네. 잔액 ${fmt(amt)}만 상환했어`, 'success');
      } else {
        flashHint(repayHintEl, `대출 ${fmt(amt)} 상환했어`, 'success');
      }
      S.loanTotal -= amt;
      S.cash -= amt;
      checkBankrupt();
      repayAmountEl.value = '';
      render();
    });
    repayAmountEl.addEventListener('keydown', e=>{ if(e.key==='Enter') repayBtn.click(); });

    investBtn.addEventListener('click', ()=>{
      const name = (bizNameEl.value || '').trim();
      const amt = clampInt(bizInvestEl.value);
      if(!name || amt<=0) return;
      if(S.cash < amt){
        flashHint(investHintEl, '현금이 부족해… 대출로 자금을 마련해볼까', 'danger');
        return;
      }
      const biz = {
        id: crypto.randomUUID(),
        name,
        invest: amt,
        upkeep: Math.floor(amt * 0.10),
        age: 0,
        lastRevenue: 0,
        lastOutcome: null
      };
      S.businesses.push(biz);
      S.cash -= amt;
      S.currentTurnInvest += amt;
      bizNameEl.value=''; bizInvestEl.value='';
      flashHint(investHintEl, `사업 "${escapeHtml(name)}"에 ${fmt(amt)} 투자했어`, 'success');
      render();
    });
    bizNameEl.addEventListener('keydown', e=>{ if(e.key==='Enter') bizInvestEl.focus(); });
    bizInvestEl.addEventListener('keydown', e=>{ if(e.key==='Enter') investBtn.click(); });

    // 매각 버튼 위임 처리
    bizGridEl.addEventListener('click', (e)=>{
      const btn = e.target.closest('.sellBtn');
      if(!btn) return;
      if(S.bankrupt) return;
      const id = btn.dataset.id;
      const idx = S.businesses.findIndex(x=> x.id === id);
      if(idx >= 0){
        const b = S.businesses[idx];
        const gain = Math.floor(b.invest * 0.10);
        S.cash += gain;
        S.businesses.splice(idx,1);
        flashHint(investHintEl, `"${escapeHtml(b.name)}" 매각으로 ${fmt(gain)} 회수했어`, 'success');
        checkBankrupt();
        render();
      }
    });

    nextBtn.addEventListener('click', ()=>{ if(S.bankrupt) return; runTurn(); render(); });

    resetBtn.addEventListener('click', ()=>{
      if(confirm('모든 진행을 리셋할까?')){
        S = structuredClone(defaultState);
        render();
      }
    });

    function runTurn(){
      const interest = Math.floor(S.loanTotal * 0.10);
      let upkeepTotal = 0;
      let revenueTotal = 0;

      // For each business
      for(const b of S.businesses){
        const upkeep = Math.floor(b.invest * 0.10);
        upkeepTotal += upkeep;
        let revenue = 0;
        let outcome = null;
        if(b.age >= 1){
          const r = Math.random();
          if(r < 0.04){ outcome = '대호황'; revenue = Math.floor(upkeep * 1.7); }
          else if(r < 0.24){ outcome = '호황'; revenue = Math.floor(upkeep * 1.4); }
          else if(r < 0.94){ outcome = '본전'; revenue = Math.floor(upkeep * 1.1); }
          else if(r < 0.99){ outcome = '불황'; revenue = Math.floor(upkeep * 0.7); }
          else { outcome = '대불황'; revenue = Math.floor(upkeep * 0.3); }
        } else {
          outcome = '신규';
          revenue = 0;
        }
        b.lastRevenue = revenue;
        b.lastOutcome = outcome;
        revenueTotal += revenue;
        b.age += 1;
      }

      // Money flow
      const spend = S.currentTurnInvest + interest + upkeepTotal;
      S.cash -= (interest + upkeepTotal);
      S.cash += revenueTotal;

      // Last turn ledger
      S.last = {
        spend,
        invest: S.currentTurnInvest,
        interest,
        upkeep: upkeepTotal,
        revenue: revenueTotal
      };

      checkBankrupt();

      // Prepare next
      S.currentTurnInvest = 0;
      S.turn += 1;
    }

    function flashHint(node, text, kind){
      node.textContent = text;
      node.classList.remove('danger','success');
      if(kind) node.classList.add(kind);
      setTimeout(()=>{ node.textContent=''; node.classList.remove('danger','success'); }, 2600);
    }

    function save(){
      try{ localStorage.setItem('loan-invest-sim-v1', JSON.stringify(S)); }catch(e){}
    }
    function load(){
      try{
        const raw = localStorage.getItem('loan-invest-sim-v1');
        return raw ? JSON.parse(raw) : null;
      }catch(e){ return null; }
    }

    // Initial
    render();
  </script>
</body>
</html>
