<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>글자수 계산기</title>
<style>
  :root{
    --bg:#0f1115; --fg:#e6e6e6; --muted:#9aa3b2; --accent:#6aa9ff;
    --over-bg:rgba(255,0,0,.25); --border:#222733;
    --mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
  }
  html,body{height:100%;}
  body{
    margin:0; background:var(--bg); color:var(--fg);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,"Noto Sans KR",sans-serif;
  }
  .wrap{max-width:980px; margin:40px auto; padding:0 16px;}
  h1{font-size:22px;font-weight:700;margin:0 0 16px;}
  .panel{border:1px solid var(--border);border-radius:12px;padding:16px;background:#0c0e13;}
  .controls{display:flex;flex-wrap:wrap;gap:12px;align-items:center;margin-bottom:12px;}
  .controls label{font-size:14px;color:var(--muted);display:flex;align-items:center;gap:8px;}
  .controls input[type="number"],
  .controls select{
    padding:8px 10px;border:1px solid var(--border);border-radius:10px;
    background:#0a0c10;color:var(--fg);
  }
  .controls input[type="number"]{width:140px;}
  .stats{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin:8px 0 14px;}
  .stat{border:1px solid var(--border);border-radius:10px;padding:10px 12px;background:#0b0e12;}
  .stat .label{font-size:12px;color:var(--muted);margin-bottom:6px;}
  .stat .value{font-family:var(--mono);font-size:18px;}

  .editor-wrap{position:relative;}
  textarea,
  .mirror{
    font:14px/1.6 var(--mono);
    padding:14px; border:1px solid var(--border); border-radius:12px;
    background:#0a0c10; height:360px; overflow:auto; white-space:pre;
  }
  textarea{
    position:relative; z-index:2; width:100%; resize:vertical;
    color:var(--fg); background:transparent; caret-color:var(--fg);
  }
  .mirror{
    position:absolute; inset:0; z-index:1; pointer-events:none; color:var(--fg);
    overflow:hidden; scrollbar-width:none; -ms-overflow-style:none;
  }
  .mirror::-webkit-scrollbar{display:none;}
  .mirror .over{background:var(--over-bg);border-radius:2px;}

  .help{font-size:12px;color:var(--muted);margin-top:10px;}
  .footer{margin-top:18px;font-size:12px;color:var(--muted);}
  a{color:var(--accent);text-decoration:none;}
</style>
</head>
<body>
  <div class="wrap">
    <h1>글자수 계산기</h1>
    <div class="panel">
      <div class="controls">
        <label>글자수 제한
          <input id="limit" type="number" min="0" step="1" placeholder="예: 1500">
        </label>
        <label>제한 기준
          <select id="basis">
            <option value="online" selected>온라인 서비스용</option>
            <option value="include">공백 포함</option>
            <option value="exclude">공백 제외</option>
          </select>
        </label>
      </div>

      <div class="stats">
        <div class="stat"><div class="label">공백 제외</div><div class="value" id="v-exclude">0</div></div>
        <div class="stat"><div class="label">공백 포함</div><div class="value" id="v-include">0</div></div>
        <div class="stat"><div class="label">온라인 서비스용</div><div class="value" id="v-online">0</div></div>
      </div>

      <div class="editor-wrap">
        <div id="mirror" class="mirror" aria-hidden="true"></div>
        <textarea id="input" wrap="off" spellcheck="false" placeholder="여기에 입력하면 실시간으로 계산해줄게…"></textarea>
      </div>

      <div class="help">
        • 온라인 서비스용: ASCII 가시(U+0020–007E) + 확장 ASCII 가시(U+00A0–00FF)=1, 그 외=2…  
        • 공백 제외는 스페이스·탭·줄바꿈 같은 공백류 빼고 세었어…
      </div>
    </div>

    <div class="footer">ChatGPT o3</div>
  </div>

<script>
(function(){
  const $ta = document.getElementById('input');
  const $mirror = document.getElementById('mirror');
  const $limit = document.getElementById('limit');
  const $basis = document.getElementById('basis');
  const $vExclude = document.getElementById('v-exclude');
  const $vInclude = document.getElementById('v-include');
  const $vOnline  = document.getElementById('v-online');

  const isPrintableASCII = cp => (cp>=0x20 && cp<=0x7E);
  const isPrintableExtended = cp => (cp>=0xA0 && cp<=0xFF);
  const isWhitespaceChar = ch => /\s/u.test(ch);

  function countAll(text){
    let inc=0, exc=0, onl=0;
    for(const ch of text){
      const cp = ch.codePointAt(0);
      inc += 1;
      if(!isWhitespaceChar(ch)) exc += 1;
      onl += (isPrintableASCII(cp)||isPrintableExtended(cp)) ? 1 : 2;
    }
    return {inc, exc, onl};
  }

  function overflowStartIndex(text, limit, basis){
    if(!(limit>0)) return -1;
    let acc=0, idx=0;
    for(const ch of text){
      const cp = ch.codePointAt(0);
      let add=1;
      if(basis==='exclude'){
        add = isWhitespaceChar(ch)?0:1;
      }else if(basis==='online'){
        add = (isPrintableASCII(cp)||isPrintableExtended(cp))?1:2;
      }
      acc += add;
      if(acc>limit) return idx;
      idx += 1;
    }
    return -1;
  }

  const escapeHTML = s => s.replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));

  function renderMirror(text, overStart){
    const arr = Array.from(text);
    if(overStart<0||overStart>=arr.length){
      $mirror.innerHTML = escapeHTML(arr.join(''));
      return;
    }
    const head = escapeHTML(arr.slice(0,overStart).join(''));
    const tail = escapeHTML(arr.slice(overStart).join(''));
    $mirror.innerHTML = head + '<span class="over">' + tail + '</span>';
  }

  function syncScroll(){
    $mirror.scrollTop  = $ta.scrollTop;
    $mirror.scrollLeft = $ta.scrollLeft;
  }

  function update(){
    const txt = $ta.value;
    const {inc,exc,onl} = countAll(txt);
    $vInclude.textContent = inc;
    $vExclude.textContent = exc;
    $vOnline.textContent  = onl;

    const overStart = overflowStartIndex(txt, parseInt($limit.value,10), $basis.value);
    renderMirror(txt, overStart);
  }

  $ta.addEventListener('input', update);
  $ta.addEventListener('scroll', syncScroll);
  $limit.addEventListener('input', update);
  $basis.addEventListener('change', update);

  update();
})();
</script>
</body>
</html>
