<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Seal‑Escape 9×9 (Responsive)</title>
  <style>
    /* ------------- Responsive layout ------------- */
    body{margin:0;padding:1rem;font-family:system-ui,sans-serif;display:flex;flex-direction:column;align-items:center;gap:1rem;background:#fafafa}

    /* 보드는 뷰포트 기준 90vmin, 최대 540px */
    #board{width:min(90vmin,540px);height:min(90vmin,540px);display:grid;grid-template-columns:repeat(9,1fr);grid-template-rows:repeat(9,1fr);outline:2px solid #333}

    .cell{width:100%;height:100%;border:1px solid #999;box-sizing:border-box;display:flex;align-items:center;justify-content:center;user-select:none;cursor:pointer;font-size:clamp(.6rem,1.8vmin,.95rem)}

    .player{background:#2e7d32;color:#fff}
    .ai{background:#c62828;color:#fff}

    .tomb{background:#555;position:relative;color:#fff}
    .tomb::after{content:"†";position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:#fafafa;font-size:clamp(.8rem,2.2vmin,1.2rem);font-weight:bold;pointer-events:none}

    .sealed{background:#e0e0e0;position:relative}
    .sealed::after{content:"✕";position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:#f00;font-weight:bold;font-size:clamp(.9rem,2.2vmin,1.3rem);pointer-events:none}

    .highlight{background:#cfe8ff}

    #info{display:flex;gap:1.5rem;font-size:clamp(.9rem,2.2vmin,1.1rem)}
    #message{min-height:1.2rem;font-size:clamp(.9rem,2.3vmin,1.1rem)}
    #controls{display:flex;gap:.5rem}
    button{padding:.45rem 1rem;font-size:clamp(.9rem,2.3vmin,1rem);cursor:pointer}
  </style>
</head>
<body>
  <h1 style="margin:0 0 .5rem 0;font-size:clamp(1.2rem,3vmin,1.6rem)">9×9 Seal‑Escape Game</h1>
  <div id="info">
    <div>턴: <span id="turnNum">0</span></div>
    <div>봉인 해제까지: <span id="turnsLeft">5</span></div>
  </div>
  <div id="board"></div>
  <div id="message"></div>
  <div id="controls">
    <button id="startBtn">게임시작</button>
    <button id="restartBtn" style="display:none;">다시시작</button>
  </div>
<script>
/* ===== constants ===== */
const SIZE = 9;
const UNSEAL_INTERVAL = 5;
const UNSEAL_COUNT = 2;
const dirs=[[1,0],[-1,0],[0,1],[0,-1]];
const inBounds=(r,c)=>r>=0&&r<SIZE&&c>=0&&c<SIZE;

/* ===== state ===== */
let board,player,aiPieces,turnCnt,countdown,phase; // phase:'playerMove'|'playerSeal'

/* ===== dom ===== */
const boardEl=document.getElementById('board');
const msgEl=document.getElementById('message');
const turnEl=document.getElementById('turnNum');
const leftEl=document.getElementById('turnsLeft');
const startBtn=document.getElementById('startBtn');
const restartBtn=document.getElementById('restartBtn');

/* ===== helpers ===== */
const cellEl=(r,c)=>boardEl.children[r*SIZE+c];
const randInner=()=>Math.floor(Math.random()*(SIZE-2))+1;
function legalMoves(ent){return dirs.map(([dr,dc])=>({r:ent.r+dr,c:ent.c+dc})).filter(p=>inBounds(p.r,p.c)&&board[p.r][p.c]==='empty');}
function flood(sr,sc){const seen=Array.from({length:SIZE},()=>Array(SIZE).fill(false));let q=[[sr,sc]],n=0;seen[sr][sc]=true;while(q.length){const [r,c]=q.pop();n++;for(const[dr,dc]of dirs){const nr=r+dr,nc=c+dc;if(inBounds(nr,nc)&&!seen[nr][nc]&&board[nr][nc]==='empty'){seen[nr][nc]=true;q.push([nr,nc]);}}}return n;}
const randomEmpty=()=>{const a=[];board.forEach((row,r)=>row.forEach((v,c)=>v==='empty'&&a.push({r,c})));return a[Math.floor(Math.random()*a.length)];};
const updateHUD=()=>{turnEl.textContent=turnCnt;leftEl.textContent=countdown;};
const clearHL=()=>boardEl.querySelectorAll('.highlight').forEach(e=>e.classList.remove('highlight'));
function hlMoves(ent){clearHL();legalMoves(ent).forEach(p=>cellEl(p.r,p.c).classList.add('highlight'));}
function hlSeals(){clearHL();board.forEach((row,r)=>row.forEach((v,c)=>v==='empty'&&cellEl(r,c).classList.add('highlight')));} 

/* ===== board build ===== */
function buildBoard(){board=Array.from({length:SIZE},()=>Array(SIZE).fill('empty'));boardEl.innerHTML='';for(let r=0;r<SIZE;r++)for(let c=0;c<SIZE;c++){const d=document.createElement('div');d.className='cell';d.dataset.row=r;d.dataset.col=c;d.addEventListener('click',onCell);boardEl.appendChild(d);}}
function placePieces(){let pr,pc,ar1,ac1,ar2,ac2;do{pr=randInner();pc=randInner();ar1=randInner();ac1=randInner();ar2=randInner();ac2=randInner();}while((pr===ar1&&pc===ac1)||(pr===ar2&&pc===ac2)||(ar1===ar2&&ac1===ac2));player={r:pr,c:pc};aiPieces=[{r:ar1,c:ac1,alive:true},{r:ar2,c:ac2,alive:true}];board[pr][pc]='player';board[ar1][ac1]='ai';board[ar2][ac2]='ai';}

/* ===== rendering ===== */
function draw(){for(let r=0;r<SIZE;r++)for(let c=0;c<SIZE;c++){const el=cellEl(r,c);el.className='cell';if(board[r][c]==='player')el.classList.add('player');else if(board[r][c]==='ai')el.classList.add('ai');else if(board[r][c]==='sealed')el.classList.add('sealed');else if(board[r][c]==='tomb')el.classList.add('tomb');}}
function move(ent,r,c,tag){board[ent.r][ent.c]='empty';ent.r=r;ent.c=c;board[r][c]=tag;}
function seal(r,c){board[r][c]='sealed';}
function unseal(k){const s=[];board.forEach((row,r)=>row.forEach((v,c)=>v==='sealed'&&s.push({r,c})));for(let i=0;i<k&&s.length;i++){const idx=Math.floor(Math.random()*s.length);const {r,c}=s.splice(idx,1)[0];board[r][c]='empty';}draw();}
function declare(w){clearHL();msgEl.textContent=w+' 승리!';restartBtn.style.display='inline-block';}
function checkWin(){if(!legalMoves(player).length){declare('AI');return true;}if(aiPieces.every(p=>!p.alive)){declare('플레이어');return true;}return false;}
function advance(){turnCnt++;countdown--;updateHUD();if(countdown===0){unseal(UNSEAL_COUNT);countdown=UNSEAL_INTERVAL;msgEl.textContent='5턴 경과! 봉인 2칸 해제.';}}
function aiTurn(){for(const p of aiPieces){if(!p.alive)continue;const moves=legalMoves(p);if(!moves.length){board[p.r][p.c]='tomb';p.alive=false;continue;}let best=moves[0],bestS=-1;moves.forEach(m=>{const s=flood(m.r,m.c);if(s>bestS){bestS=s;best=m;}});move(p,best.r,best.c,'ai');}
draw();if(checkWin())return;const pMoves=legalMoves(player);const tgt=pMoves.length?pMoves.sort((a,b)=>flood(b.r,b.c)-flood(a.r,a.c))[0]:randomEmpty();seal(tgt.r,tgt.c);draw();advance();if(checkWin())return;phase='playerMove';hlMoves(player);msgEl.textContent='플레이어 차례: 이동할 칸을 선택해.';}
function endPlayer(){clearHL();advance();if(checkWin())return;aiTurn();}
function onCell(e){const r=+e.currentTarget.dataset.row,c=+e.currentTarget.dataset.col;if(!e.currentTarget.classList.contains('highlight'))return;if(phase==='playerMove'){move(player,r,c,'player');draw();phase='playerSeal';hlSeals();msgEl.textContent='이제 봉인할 칸을 골라.';}else if(phase==='playerSeal'){seal(r,c);draw();endPlayer();}}

/* ===== start ===== */
function start(){buildBoard();placePieces();turnCnt=0;countdown=UNSEAL_INTERVAL;phase='playerMove';updateHUD();draw();hlMoves(player);msgEl.textContent='플레이어 차례: 이동할 칸을 선택해.';startBtn.style.display='none';restartBtn.style.display='none';}
startBtn.onclick=start;restartBtn.onclick=start;
</script>
</body>
</html>
